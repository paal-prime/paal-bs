\chapter{Steiner Forest algorithms}

\section{Problem description}
Steiner Forest Problem (SFP)\\
Given an undirected graph $G = (V, E)$, a cost function on edges $c : E \rightarrow Q^+$, and a collection of disjoint subsets of $V$, $S_1, \dots S_k$, find a minimum cost subgraph in which each pair of vertices belonging to the same set $S_i$ is connected.
For $k = 1$ the problem is known as Steiner Tree Problem (STP).

\section{Primal-Dual Method algorithm}
Local searches written in our framework were compared to a 2-approximation algorithm described by Vazirani [Vazirani]. As far as we know, it's the best approximation algorithm for a SFP known to date.

Time complexity of provided implementation is $\Oh(S(E + V\alpha(V) + \log(S)))$ where $S = \sum_{i = 1}^{k}S_i$, $\alpha(V)$ is the inverse of the function $n = f(x) = A(x, x)$ and $A$ is Ackermann function.

\section{Create and break cycle local search}
Given some solution to Steiner Forest Problem ,,Create and break cycle'' (CBC) local search changes it by randomly adding edge between solution's vertices. If added edge created a cycle then the heaviest edge from this cycle is removed. It's obvious that obtained graph is still a feasible solution. After described operation it might happen that some edges are no longer needed like for example edges adjacent to leafs that don't belong to $S_i$ for any $i \in \{1, \dots k\}$. Therefore pruning procedure is used to ensure that only essential edges remains which might lead to further fitness improvement.

Provided Walker implementation takes $\Oh(V\log(V) + KV)$ time to prepare a step, where $K$ is a limit of attempts to choose a random edge with propierties as described above. In practice the limit is hardly ever reached and preparing step takes $\Oh(V\log(V)$.

\section{Minimum spanning tree of active vertices local search}
,,MST of active vertices'' (MSTAV) local search starts with some feasible solution of SFP. At each step a new solution is created by computing a pruned minimum spanning tree of $G'$ which is a subgraph of $G$ induced by some set of vertices $V'$ called active vertices. $V'$ is obtained from vertices belonging to the previous solution after randomly applying one of the following operations:
\begin{itemize}
\item add a random vertex that's not already in the set,
\item remove a random vertex from the set,
\item do both operations described above.
\end{itemize}

Note that it might happen that there is no feasible solution in $G'$. Therefore at the end of each step local search checks whether proposed solution is feasible and if it is not then it reverts any changes.

Provided Walker implementation takes $\Oh(E \log(V))$ time to prepare a step.

\section{Benchmarks}
To compare the algorithms we have used our randomly generated tests and a subset of SteinLib\footnote{\url{http://steinlib.zib.de}} tests for Steiner Tree Problem.
Names of tests generated by us can be expressed as regular expression $[s\ |\ d][E\ |\ R]V<\text{vertices count}>K<\text{terminal vertices count}>$. Letters $s, d$ tells whether graph is sparse or dense and letters $E, R$ tells accordingly whether graph is Euclidean or if edges were given random weight. Descriptions of SteinLib tests can be found at \url{http://steinlib.zib.de}.

In every test Walker starts with a pruned MST as starting solution.
\section{Results}

\subsection{Comparison of hill climbing and simulated annealing convergence}
TODO: krotko napisac, ze SA nie dziala i dlaczego ; dalej bede rozwazal tylko HillClimby

\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/CBC-01dEV100K30}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/CBC-02dEV100K30}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/CBC-alue2087}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/CBC-berlin52}
\end{figure}

\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/MSTAV-01dEV100K30}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/MSTAV-02dEV100K30}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/MSTAV-alue2087}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerConvergence/MSTAV-berlin52}
\end{figure}

\subsection{CBC and MSTAV convergence comparison}
TODO: napisac, ze MSTAV > CRC, zasugerowac dlaczego

\begin{figure}[H]
\input{../results/steiner/SteinerLSComparison/CBCvsMSTAV-01sEV100K30}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerLSComparison/CBCvsMSTAV-01sRV1000K150}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerLSComparison/CBCvsMSTAV-d05}
\end{figure}
\begin{figure}[H]
\input{../results/steiner/SteinerLSComparison/CBCvsMSTAV-gap1307}
\end{figure}

\subsection{Comparison of found solutions' cost}
TODO: napisac, ze na malych testach, praktycznie zawsze MSTAV jest bliski lub lepszy od apx,
na srednich testach bywa roznie, ale zazwyczaj wciaz MSTAV daje rade,
na duzych roznica jest zdecydowana ; na malych testach CBC radzi sobie dosc dobrze

\begin{figure}[H]
  \centering
  \input{../results/steiner/SteinerComparison/comparisonSmallerForestTests}
\end{figure}

\begin{figure}[H]
  \centering
  \input{../results/steiner/SteinerComparison/comparisonSmallerTreeTests}
\end{figure}

\begin{figure}[H]
  \centering
  \input{../results/steiner/SteinerComparison/comparisonLargerForestTests}
\end{figure}

\begin{figure}[H]
  \centering
  \input{../results/steiner/SteinerComparison/comparisonLargerTreeTests}
\end{figure}

